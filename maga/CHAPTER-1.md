# Глава 1. Основы и мотивация для создания открытой доверенной операционной системы для СнК на архитектуре RISC-V

 ## 1.1 Основы и мотивация

  ### 1.1.1 Общие сведения о доверенных средах исполнения

   #### 1.1.1.1 Введение в доверенные среды исполнения

   Практически все современные вычислительные устройства,
   начиная от смартфонов и ПК, до автомобилей и серверных систем,
   используют несколько операционных систем
   одновременно на одном процессоре.
   Такие вычислительные среды обычно состоит из
   обычной среды исполнения,
   в которой работают основная операционная система
   и пользовательские приложения,
   и отдельной безопасной среды исполнения,
   предназначенной для защиты конфиденциальных данных и кода.
   Основная цель такого разделения - обеспечить аппаратную изоляцию,
   позволяющую безопасно выполнять конфиденциальные вычисления, такие как
   криптография, управление цифровыми правами (DRM) или обработка платежей
   без возможности вмешательства внешних компонентов системы
   или потенциальных злоумышленников.

   При такой конфигурации с двумя средами
   обычная операционная система управляет повседневными задачами,
   в то время как конфиденциальные операции
   выполняются в защищенной среде.
   Такое разделение имеет решающее значение
   для обеспечения безопасности и целостности
   конфиденциальных данных и операций.
   Обычный мир (или Нормальный мир),
   в котором работает основная операционная система,
   обычно считается ненадежным по сравнению с защищенным миром,
   который спроектирован так,
   чтобы быть безопасным и изолированным.

   Концепция доверенных сред исполнения (TEE)
   стала важнейшим компонентом современных архитектур.
   TEE обеспечивают безопасную среду
   для выполнения конфиденциального кода и
   обработки конфиденциальных данных,
   изолированную от обычной среды исполнения.
   Эта изоляция обеспечивается аппаратными механизмами,
   гарантирующими, что даже в случае полной компроментации
   основной операционной системы или приложений
   в нормальном мире - безопасность конфиденциальных данных
   в защищенном мире остается неизменной.

   Таким образом, доверенные среды исполнения
   являются фундаментальным компонентом
   современных вычислительных сред.
   Обеспечение необходимой изоляции
   и защита конфиденциальных данных и кодв
   делает их незаменимыми в современных реалиях.

   #### 1.1.1.2 Эволюция доверенных сред исполнения

   С момента появления - доверенные среды исполнения
   претерпели значительные изменения,
   обусловленные необходимостью безопасного выполнения кода
   и конфиденциальности данных в современных вычислительных системах.
   Концепция TEE возникла как ответ на растущий спрос на безопасные среды, способные защитить от различных типов атак и угроз.

   Самыми ранними формами TEE были
   специализированные защищенные сопроцессоры
   или специальные аппаратные модули,
   такие как смарт-карты и доверенные платформенные модули (TPMS).
   Эти ранние реализации были разработаны
   для обеспечения безопасной среды для
   выполнения конкретных задач,
   таких как криптографические операции
   и безопасная аутентификация.
   Как правило, они были изолированы от основного процессора
   и обладали собственными защищенными возможностями
   хранения и обработки данных.

   По сравнению со старыми версиями TEE,
   современные TEE стали более интегрированными
   с основным процессором и операционной системой.
   Нынешние Доверенные Системы Исполнения предлагают
   более продвинутые функции безопасности,
   такие как шифрование памяти,
   безопасная загрузка и механизмы проверки подлинности.
   Современные TEE также обеспечивают более гибкую и программируемую среду,
   позволяющую выполнять сложные приложения и сервисы.

   Эволюция TEE позволила получить представление
   о разработке и внедрении Доверенных Сред Исполнения.
   Ожидается, что будущие разработки TEE будут направлены на устранение
   все новых возникающих угроз и вызовов.
   Кроме того, TEE, вероятно, станут еще более интегрированными
   с основными вычислительными системами,
   что позволит более эффективно и безопасно выполнять
   доверенный код и сохранять конфиденциальность данных.

   #### 1.1.1.3 Роль доверенных сред исполнения в современных архитектурах безопасности

   Доверенные среды исполнения играют решающую роль в
   современных системах безопасности,
   обеспечивая безопасную среду для
   выполнения доверенного кода и
   обработки конфиденциальных данных.
   Современные TEE, такие как
   ARM TrustZone и Intel SGX,
   обеспечивают аппаратную изоляцию основного процессора.
   Такая изоляция позволяет выполнять
   сложные доверенные приложения в сочетании
   с богатой функционалом универсальной операционной системой.

   Возможности современных TEE
   выходят за рамки простых криптографических задач.
   Они поддерживают широкий спектр сложных приложений,
   включая защищенный пользовательский интерфейс,
   сертификацию, аттестацию
   и доверенные вычисления в облачных инфрастуктурах.

   Несмотря на их популярность и значительные преимущества,
   которые предлагают доверенные системы исполнения,
   спрос на TEE с прозрачными интерфейсами и
   открытым исходным кодом остается.
   Основными причинами этого спроса являются
   стремление преодолеть зависимость от поставщиков
   и повысить безопасность с помощью тщательных проверок.
   TEE с открытым исходным кодом могут быть
   тщательно изучены более широким кругом участников сообщества,
   что потенциально может привести к
   более безопасной реализации,
   поскольку уязвимости могут быть
   выявлены и устранены более эффективно.

   Более того, поскольку вычислительные среды становятся
   все более разнородными и многоядерными,
   растет потребность в TEE,
   которые могут эффективно поддерживать такие архитектуры.
   Способность управлять разнообразными вычислительными
   ресурсами и обеспечивать их безопасность
   становится необходимым условием
   для поддержания общего уровня безопасности
   современных систем.

  ### 1.1.2. Текущее состояние ДСИ в проприетарных архитектурах

   #### 1.1.2.1. Ограничения существующих ДСИ в проприетарных архитектурах

   Традиционные доверенные среды исполнения
   в проприетарных архитектурах,
   таких как платформы ARM, Intel и AMD,
   накладывают ряд фундаментальных ограничений.
   Эти ограничения влияют как на гибкость
   решений по обеспечению безопасности,
   так и на более широкую технологическую экосистему.

   Большинство проприетарных TEE тесно связаны
   с платформой поставщика оборудования,
   что создает среду сильной привязанности к поставщику.
   Потребители этих технологий,
   будь то системные интеграторы
   или разработчики приложений,
   зависят от производителя оборудования
   в плане долгосрочных обновлений безопасности,
   поддержки и совместимости с экосистемой.
   Эта зависимость ограничивает
   внедрение пользовательских функций
   и препятствует внедрению инноваций,
   поскольку все усовершенствования
   должны согласовываться с планом действий
   поставщика и процессом утверждения.

   Реализации проприетарных TEE, как правило,
   имеют закрытый исходный код,
   а важные архитектурные детали остаются нераскрытыми.
   Отсутствие прозрачности означает,
   что пользователи и исследователи не могут
   в полной мере проводить аудит,
   изменять или проверять
   корректность и безопасность реализаций TEE.
   Кроме того, разработка надежных приложений зависит
   от жестко контролируемых инструментов поставщиков,
   SDK и проприетарных API,
   которые препятствуют переносимости,
   независимой проверке и росту экосистемы
   сторонних разработчиков.

   Традиционные производители проприетарных процессоров
   предоставляют только фиксированный набор команд,
   практически без возможности настройки или расширения
   системными интеграторами.
   Такое отсутствие гибкости ISA
   замедляет реагирование на возникающие угрозы
   и ограничивает возможности исследователей
   в изучении альтернативных конструкций TEE.

   Каждая запатентованная архитектура,
   как правило, обеспечивает свою собственную
   уникальную реализацию TEE,
   спецификации интерфейса и управление жизненным циклом.
   В результате, TEE, как правило,
   несовместимы между поставщиками
   или даже между различными линейками продуктов
   одного и того же поставщика.
   Такой изолированный подход приводит к фрагментации,
   усложняет разработку кросс-платформенных
   защищенных приложений и
   сокращает возможности для более широкой стандартизации
   и внедрения передовых методов
   обеспечения безопасности
   в масштабах всей отрасли.

   #### 1.1.2.2 Лицензирование в проприетарных архитектурах

   Требования к лицензированию,
   связанные с проприетарными архитектурами,
   такими как ARM TrustZone и Intel SGX,
   играют основную роль в формировании
   экосистемы сред доверенного исполнения.
   Эти лицензии имеют важные экономические,
   юридические и технические последствия,
   которые влияют на каждый этап разработки
   и развертывания защищенных операционных систем.

   Одним из важнейших последствий лицензирования является
   его непосредственное влияние
   на экономику разработки устройств и систем.
   Доступ к расширениям безопасности или ДСИ
   обычно влечет за собой значительные лицензионные платежи,
   которые должны выплачиваться либо авансом
   в качестве затрат на разработку,
   либо постоянно в виде лицензионных отчисленый,
   привязанных к объемам производства.
   Для развивающихся компаний и инновационных проектов,
   работающих с ограниченными ресурсами,
   эти затраты могут стать существенными препятствиями
   для выхода на рынок.
   Даже для хорошо зарекомендовавших себя поставщиков
   эти сборы увеличивают общую стоимость продукта,
   снижая рентабельность и приводя к увеличению затрат
   для конечных пользователей.

   Кроме того, наличие ограничений на лицензирование
   может ограничить масштабируемость.
   Например, эксперименты с новыми сферами использования,
   разработка пользовательских аппаратных расширений
   или внедрение модификаций продуктов
   для нишевых или региональных рынков
   могут стать непомерно дорогостоящими,
   если каждое изменение требует пересмотра условий
   или дополнительных затрат на лицензирование.

   Помимо финансовых затрат,
   лицензионные соглашения четко определяют
   и часто ограничивают допустимые сценарии использования
   и профили разрабатываемых устройств.
   Эти ограничения могут касаться конфигураций оборудования,
   конкретных программных пакетов
   или географии производства и продажи.
   Они также могут препятствовать техническим инновациям,
   поскольку любое желаемое отклонение
   от эталонных платформ или требований
   к программному обеспечению поставщика,
   скорее всего, потребует повторной юридической проверки
   и новых переговоров о лицензировании.

   Кроме того, наибольшую обеспокоенность
   у многих долгосрочных проектов вызывает неопределенность,
   связанная с использованием лицензий третьих лиц.
   Поставщики могут в одностороннем порядке
   изменять условия лицензирования,
   вводя новые ограничения,
   увеличивая затраты или даже полностью отказать в правах.
   Такая непредсказуемость особенно актуальна для продуктов,
   рассчитанных на длительный срок службы
   (например, промышленных контроллеров,
   автомобильных ЭБУ,
   медицинских устройств),
   где безопасная эксплуатация и техническое обслуживание
   могут потребоваться в течение десятилетия и более.
   Чрезмерная зависимость от внешнего лицензирования
   представляет потенциальную угрозу устойчивости проекта,
   его ремонтопригодности и даже соблюдению нормативных требований.

   Таким образом, операционная гибкость оказывается ограничена.
   Это особенно проблематично в исследовательских средах
   (при быстром создании прототипов)
   и в промышленных приложениях на заказ
   (где необходимы эксперименты и быстрая итерация).
   Наличие эталонных разработок с закрытым исходным кодом
   и фирменного микропрограммного обеспечения
   еще больше ограничивает возможности пользователей
   по проверке или настройке низкоуровневых механизмов безопасности,
   препятствуя прозрачности и независимой проверке.

   Эти ограничения в совокупности создают
   замкнутость вокруг проприетарных ДСИ,
   препятствуя функциональной
   совместимости и независимому росту экосистемы.
   Сотрудничество между независимыми поставщиками,
   исследовательскими институтами
   и сообществом разработчиков
   с открытым исходным кодом ограничено
   правовой неопределенностью
   и отсутствием доступа к базовым технологиям.
   В результате общий темп внедрения инноваций
   в области безопасных вычислений замедляется.
   Техническому сообществу не удается
   коллективно реагировать на новые угрозы
   или разрабатывать и внедрять новые средства защиты.

  ### 1.1.3. Перспективы RISC-V: открытость и расширяемость

   #### 1.1.3.1. Аппаратное обеспечение с открытым исходным кодом

   В резком контрасте с этой устоявшейся парадигмой,
   зараждение движения за
   аппаратное обеспечение с открытым исходным кодом (OSHW),
   примером которого является появление и стремительный рост RISC-V,
   предлагает преобразующую альтернативу.
   RISC-V - это не реализация конкретного процессора,
   а ISA с открытым стандартом,
   что означает, что его базовая спецификация
   и связанная с ней документация находятся
   в свободном доступе для любого пользователя,
   который может использовать, внедрять,
   проектировать или расширять их без лицензионных сборов
   или ограничительных соглашений.
   Этот фундаментальный переход от патентованного контроля
   имеет глубокие последствия для полупроводниковой промышленности
   и за ее пределами.

   Открытость, присущая RISC-V,
   способствует созданию действительно
   объединенной модели разработки.
   Это позволяет разнообразному мировому сообществу,
   включающему академических исследователей,
   отраслевые консорциумы,
   стартапы и признанные корпорации,
   вносить свой вклад в развитие ISA,
   разрабатывать широкий спектр основных реализаций
   (от глубоко встраиваемых микроконтроллеров
   до высокопроизводительных процессоров серверного класса)
   и делиться вспомогательными инструментами
   и программным обеспечением.
   Коллективные усилия ускоряют внедрение инноваций,
   облегчают изучение новых архитектурных особенностей
   и позволяют быстро изменять дизайн.

   Кроме того, прозрачность, обеспечиваемая открытой ISA,
   имеет первостепенное значение в контексте безопасности.
   Благодаря общедоступности спецификации и тому,
   что многие основные реализации также имеют открытый исходный код
   (доступны в виде RTL),
   проекты могут быть тщательно изучены,
   проверены на наличие потенциальных уязвимостей
   в системе безопасности независимыми
   третьими сторонами и официально подтверждены.
   Такой подход значительно расширяет возможности
   выявления и устранения недостатков в системе безопасности.
   В отличие от того,
   чтобы полагаться исключительно на заявления одного поставщика,
   контролирующего запатентованный непрозрачный дизайн.
   Такая прозрачность имеет решающее значение для укрепления доверия,
   поскольку снижает опасения по поводу
   нераскрытых функциональных возможностей,
   преднамеренных бэкдоров или недокументированного
   поведения самого процессорного оборудования.

   #### 1.1.3.2. Архитектура набора команд RISC-V

   Архитектура набора команд RISC-V является
   последним достижением в эволюции дизайна процессоров,
   предлагая современную, открытую и расширяемую основу
   для вычислений в широком спектре приложений.
   К основным характеристикам RISC-V ISA относятся ее
   приверженность принципам RISC,
   модульность и расширяемость, масштабируемость,
   а также ее открытый и бесплатный характер.
   Ее характеристики особенно важны при разработке защищенных систем,
   в том числе доверенной операционной системы,
   рассматриваемой в данной работе.

   RISC-V - это, по сути, архитектура RISC.
   В основе этой философии проектирования лежит небольшой,
   высоко оптимизированный набор инструкций.
   Ключевые характеристики включают архитектуру
   загрузки-сохранения (load-store),
   при которой к памяти обращаются только
   явные команды загрузки и сохранения,
   кодировку команд фиксированной длины
   32 бит, с возможностью сжатия до 16 бит для повышения плотности,
   и относительно большое количество регистров общего назначения.
   Такая простота не только способствует
   эффективной реализации аппаратного обеспечения
   с потенциально более низким энергопотреблением
   и более высокими тактовыми частотами,
   но и снижает сложность формальной верификации
   и анализа безопасности,
   что потенциально приводит к созданию меньшей
   и более поддающейся проверке
   доверенной вычислительной базы (TCB)
   при проектировании безопасных сред исполнения.

   Отличительной чертой RISC-V является его модульность.
   ISA разработана как небольшой базовый набор целочисленных команд,
   к которому могут быть добавлены
   стандартные дополнительные расширения.
   Эти расширения охватывают такие
   распространенные функциональные возможности,
   как умножение и деление (расширение M),
   атомарные операции (расширение A),
   операции с плавающей запятой
   одинарной и двойной точности (расширения F и D),
   сжатые инструкции (расширение C),
   векторные операции (расширение V)
   и манипулирование битами (расширение B).
   Помимо этих стандартных расширений,
   RISC-V явно резервирует пространство для
   кодирования пользовательских расширений.
   Такая расширяемость имеет решающее значение для безопасности,
   поскольку позволяет легко интегрировать специализированные расширения,
   ориентированные на безопасность.
   Расширение WorldGuard, которое занимает
   центральное место в этом тезисе,
   является примером такой архитектурной функции,
   повышающей безопасность,
   которая может быть включена в платформу RISC-V
   без изменения основной ISA.

   RISC-V ISA спроектирован таким образом,
   чтобы ее можно было масштабировать
   на широкий спектр вычислительных устройств.
   Она поддерживает 32-разрядную (RV32) и
   64-разрядную (RV64) реализацию.
   Такая масштабируемость позволяет
   использовать RISC-V в основе различных устройств -
   от встроенных микроконтроллеров и
   устройств IoT до высокопроизводительных серверов и суперкомпьютеров.
   Для систем безопасности это означает,
   что принципы и механизмы,
   разработанные для одного класса систем RISC-V,
   легко могут быть адаптированы
   и непосредственно применены к другим,
   что способствует созданию согласованной модели безопасности
   на различных платформах.

   Таким образом, RISC-V ISA обеспечивает
   гибкую, прозрачную и экономически доступную основу.
   Принципы RISC, модульность, масштабируемость и,
   в частности, бесплатный и открытый подход
   создают благоприятную почву для инноваций
   в области безопасных вычислений,
   позволяя разрабатывать специализированные аппаратные расширения,
   такие как WorldGuard, и способствуя созданию экосистемы,
   в которой могут процветать открытые,
   безопасные операционные системы.
   Эти атрибуты непосредственно поддерживают
   цели данного исследования
   по созданию открытой доверенной операционной системы
   для СнК на ахритектуре RISC-V с расширением WorldGuard.

 ## 1.2. Постановка задачи

  ### 1.2.1. Текущее положение ДСИ в архитектуре RISC-V

   #### 1.2.1.1. Текущее состояние экосистемы безопасности RISC-V

   Архитектура RISC-V, обладающая открытой и расширяемой природой,
   представляет собой сильную основу для создания
   безопасных вычислительных систем.
   Однако экосистема безопасности, окружающая RISC-V,
   в настоящее время находится на стадии зарождения,
   особенно по сравнению со зрелыми архитектурами,
   такими как ARM или x86.
   Эта незрелость проявляется в нескольких ключевых областях,
   которые создают как проблемы,
   так и возможности для разработки надежных
   доверенных сред исполнения.

   Важной проблемой существующей экосистемы безопасности RISC-V
   является отсутствие зрелых и широко распространенных
   стандартизированных реализаций
   доверенной операционной системы (SecureOS) для RISC-V.
   Хотя существуют академические проектоы SecureOS и проектов,
   ориентированных на конкретных поставщиков,
   им не хватает зрелости,
   всеобъемлющего набора функций
   (например, полного соответствия Global Platform API),
   тщательного тестирования и широкой поддержки сообщества,
   характерных для устоявшихся экосистем ДСИ.
   Это вынуждает компании либо создавать эти компоненты с нуля,
   либо полагаться на решения,
   зависящие от конкретного поставщика
   и потенциально несовместимые друг с другом.

   В то время как RISC-V определяет базовый ISA и
   аппаратные расширения,
   критически важные для безопасности, например, PMP,
   новые расширения, специфичные для ДСИ,
   такие как WorldGuard, все еще находятся
   на различных стадиях стандартизации.

   Таким образом, в то время как RISC-V ISA предлагает
   фундаментальные компоненты для обеспечения безопасности,
   в ее экосистеме безопасности наблюдается
   нехватка готовых и стандартизированных решений ДСИ
   и инструментов управления.
   Это состояние подчеркивает значительные возможности
   и необходимость разработки открытых,
   надежных и стандартизированных безопасных реализаций ОС.

   #### 1.2.1.2. Текущее состояние расширения WorldGuard

   Расширение RISC-V WorldGuard представляет собой
   активно развивающийся подход
   к обеспечению аппаратной безопасности
   на основе архитектуры RISC-V.
   Как новая спецификация, оно отражает открытый
   и расширяемый характер RISC-V,
   позволяя сообществу вносить свой вклад
   и итеративно совершенствовать его.
   Однако на момент написания работы
   WorldGuard еще не получил статус
   полностью ратифицированного стандарта RISC-V.
   Этот эволюционирующий характер подразумевает
    что спецификация все еще подвергается
    потенциальным доработкам и формализации
    в рамках сообщества RISC-V.

   Несмотря на свой неутвержденный статус,
   расширение WorldGuard уже имеет доступные реализации
   в FPGA или эмуляторах, таких как QEMU.
   И предоставляют полный набор аппаратных функций,
   предназначенных для создания довереных сред исполнения
   и управления ими.
   Этих функций достаточно для поддержки
   концепции безопасных анклавов или *миров*.
   Реализованных механизмы имеют
   решающее значение для ДСИ,
   такие как изоляция памяти,
   различные уровни привилегий
   для различных контекстов исполнения
   и контролируемые переходы между ними.
   Эти возможности формируют фундаментальные строительные блоки,
   на основе которых может быть построена надежная система ДСИ.

   #### 1.2.1.3. Поддержка WorldGuard со стороны ПО

   Однако в настоящее время в программной экосистеме WorldGuard
   существует значительный пробел,
   необходимый для использования этих аппаратных примитивов.
   Несмотря на то, что WorldGuard предоставляет
   аппаратные возможности для изоляции,
   существует явная нехватка стандартизированного
   программного обеспечения с открытым исходным кодом,
   такого как полноценная доверенная операционная система,
   специально разработанная для управления этими мирами,
   определенными WorldGuard,
   и предоставления приложениям функциональных возможностей ДСИ.
   Текущая поддержка программного обеспечения
   в значительной степени ограничивается
   проверкой концепций на низком уровне,
   академическими исследовательскими проектами
   или проприетарными для конкретных поставщиков,
   которые не являются широко доступными
   или стандартизированными для более широкого внедрения в экосистему.

   Отсутствие легкодоступной и открытой
   доверенной операционной системы означает,
   что разработчики не могут легко создавать,
   развертывать и управлять доверенными приложениями (TA),
   которые использовали бы аппаратные средства безопасности WorldGuard.
   Следовательно, потенциал WorldGuard
   по созданию надежных ДСИ на платформе RISC-V
   остается в значительной степени неиспользованным.
   Эта ситуация подчеркивает острую необходимость
   и возможность разработки доверенной операционной системы.

 ## 1.3. Актуальность и области применения

  ### 1.3.1. Стремительный рост RISC-V в коммерческой и промышленной сферах

   #### 1.3.1.1. Широкое Внедрение В Различных Областях Производства

   Архитектура RISC-V получает все более широкое распространение,
   решительно переходя из области,
   представляющей преимущественно академический
   и экспериментальный интерес,
   в область ощутимого присутствия в широком спектре
   реальных коммерческих продуктов.
   Это очевидное проникновение в ключевые
   сектороы демонстрируюет ее универсальность
   и растущее доверие отрасли.

   Например, системы промышленного контроля
   и автоматизации производства все чаще используют RISC-V СнК.
   В быстро расширяющейся области обработки данных
   RISC-V находит применение и в
   локальных и периферийных облачных вычислительных платформах,
   где его открытый характер позволяет создавать
   индивидуальные решения и ускорители для конкретных приложений,
   способствуя повышению энергоэффективности
   и оптимизации производительности.

   Кроме того, и сетевое оборудование,
   включая маршрутизаторы,
   коммутаторы и сетевые интерфейсные платы,
   чаще становится оснащено ядрами RISC-V
   для обработки пакетов и менеджментом слоями управления.
   Масштабируемость архитектуры делает ее подходящей
   для широкого спектра встраиваемой бытовой электроники,
   от маломощных микроконтроллеров в устройствах умного дома
   и портативных устройствах,
   до более сложных систем на кристаллах
   в автомобилестроении и мультимедийных устройствах.

   Такое широкое внедрение
   в различных категориях продуктов подчеркивает,
   что RISC-V выходит за рамки узкоспециализированных приложений.

   #### 1.3.1.2. Отсутствие продуктов, интегрированных в систему безопасности

   Несмотря на растущее повсеместное внедрение
   и универсальность RISC-V в различных областях,
   проблемой современного рынка является
   отсутствие глубоко интегрированных,
   поддерживаемых аппаратным обеспечением ДСИ
   в коммерчески доступных продуктах.
   Несмотря на то,
   что в настоящее время развертывается
   множество систем на кристаллах,
   основанных на RISC-V, в них отсутствуют
   функционал безопасности,
   который обычно присущ
   зрелым проприетарным архитектурам.

   Ситуация резко отличается от таких экосистем,
   как ARM, где технология TrustZone является
   широко распространенным и
   фундаментальным компонентом многих процессоров,
   или архитектуры x86,
   которая предлагает надежные решения безопасности,
   такие как Intel Software Guard Extensions (SGX)
   и AMD Secure Encrypted Virtualization (SEV),
   широко встроенные в линейки продуктов.

   Хотя базовые механизмы безопасности, такие как PMP,
   присутствуют в ядрах RISC-V,
   обеспечивая базовый уровень изоляции памяти,
   они не соответствуют полным возможностям и гарантиям,
   предоставляемым выделенным ДСИ.
   Отсутствие ПО для оснащенния ДСИ,
   в настоящее время ограничивает их применение
   в областях с жесткими требованиями к безопасности
   или требует нестандартных решений на заказ.

   #### 1.3.1.3. Мотивация к разработке доверенного ПО на базе RISC-V

   Текущее состояние RISC-V,
   характеризующееся быстрым ростом,
   но заметным отсутствием готовых интегрированных продуктов
   для обеспечения безопасности,
   является убедительной мотивацией
   для разработки специализированных решений
   для обеспечения безопасности.
   Ключевыми факторами являются:

  - Удовлетворение рыночного спроса: <br>
    Критическая роль безопасности
    в аналогичных областях применения
    ARM и x86 указывает на то,
    что рынок предъявляет высокие требования
    к защищенным продуктам по мере развития архитектуры
    и распространения в коммерческих и промышленных областях.
    Для удовлетворения ожидаемого спроса
    на надежные вычислительные возможности
    необходима активная разработка.

  - Формирование экосистемы: <br>
    Участие в создании безопасных решений
    на базе RISC-V на ранних этапах
    дает значительную возможность
    влиять на разработку стандартов,
    внедрять лучшие практики
    и вносить вклад в развитие основополагающих технологий.

  - Использование открытости RISC-V и расширений: <br>
    Открытый характер RISC-V ISA в сочетании
    с развивающимися архитектурными расширениями,
    ориентированными на безопасность,
    такими как WorldGuard,
    облегчает создание защищенных операционных систем
    с открытым исходным кодом,
    а также программных пакетов доверенных приложений.

  ### 1.3.2. Области применения доверенного ПО в современных вычислительных системах

   #### 1.3.2.1. Основной функционал безопасности в современных продуктах

   Современные компьютерные продукты,
   от мобильных устройств и автомобильных систем
   до облачной инфраструктуры и интернета вещей,
   требуют в качестве базовых требований
   надежный набор функций безопасности.
   Эти функции имеют решающее значение
   для защиты конфиденциальных данных,
   обеспечения целостности системы
   и поддержания доверия пользователей.
   Ключевыми из этих важных функций безопасности являются:

  - Безопасная загрузка (secure boot): <br>
    Этот процесс гарантирует,
    что каждый программный компонент,
    загружаемый во время запуска системы,
    от начального загрузчика до ядра операционной системы,
    является подленным.
    Он устанавливает цепочку доверия (chain of trust),
    предотвращая выполнение несанкционированного
    или вредоносного кода
    на самых ранних этапах работы системы.

  - Целостность встроенного ПО и программного обеспечения: <br>
    Помимо безопасной загрузки,
    необходимы и механизмы для постоянной
    проверки целостности компонентов ПО перед запуском.
    Это защищает от угроз и атак,
    которые могут модифицировать
    системные компоненты после загрузки.

  - Управление криптографическими ключами: <br>
    Надежная генерация, хранение,
    защита и использование криптографических ключей
    являются основополагающими в доверенном ПО.
    Ключи лежат в основе большинства служб безопасности,
    включая шифрование данных,
    цифровые подписи,
    защищенную связь (TLS/SSL)
    и идентификацию устройств.

  - Безопасное хранение: <br>
    Конфиденциальные данные,
    такие как учетные данные пользователя,
    личная информация,
    ключи шифрования и служебные данные приложений,
    должны быть надежно защищены.
    Механизмы безопасного хранения
    обеспечивают конфиденциальность и целостность,
    даже если универсальная операционная система
    или носитель информации скомпрометированыы.

  - Аттестация: <br>
    Эта возможность позволяет устройству
    предоставлять удаленному серверу
    информацию, подтверждающую его подлинность.

  - Обновления по воздуху (OTA): <br>
    Возможность удаленного и безопасного
    обновления встроенного ПО
    для внедрения новых функций
    и поддержания долгосрочной безопасности
    и функциональности устройства.

   Эти функции больше не являются
   узкоспециализированными требованиями,
   а являются неотъемлемой частью проектирования
   и эксплуатации современных вычислительных систем, что обусловлено
   ценностью обрабатываемых данных
   и меняющимся ландшафтом угроз.

   #### 3.1.2.2. Потенциал RISC-V в защищённых сценариях применения

   Cочетание открытости и расширяемости RISC-V
   с открывает широкие возможности
   для проникновения на рынки,
   где традиционно доминируют запатентованные ISA.
   Во многом это связано с потенциалом
   создания прозрачной системы,
   обеспечивающей безопасность и верифицируемость,
   способствующие повышению доверия.
   Нераскрытый потенциал проявляется
   в многочисленных сценариях применения,
   требующих высокого уровня надежности:

  - Персональные устройства: <br>
    смартфоны, планшеты, ноутбуки и носимые устройства
    могут использовать отктытую ДСИ на RISC-V
    для защиты конфиденциальных пользовательских данных,
    таких как биометрические данные,
    финансовые данные и личные сообщения.

  - Автомобильные системы: <br>
    Современные автомобили с их сложной
    сетью электронных блоков управления, управляющих всем,
    от передовых систем помощи водителю (ADAS)
    до информационно-развлекательных систем
    и систем связи V2X,
    требуют надежной изоляции
    и безопасности для обеспечения
    безопасности пассажиров,
    защиты от несанкционированного доступа
    и сохранности данных об автомобиле.

  - Конфиденциальные облачные вычисленая (ССС): <br>
    на базе RISC-V могут быть обеспечены безопасные анклавы
    для обработки конфиденциальных данных
    в мультитенантных облачных средах,
    обеспечивая защиту "data-in-use"
    (когда даже поставщик облачных услуг
    не может получить доступ
    к расшифрованным данным).

  - Экосистема Интернета вещей (IoT): <br>
    Обширный и разнообразный характер
    устройств интернета вещей,
    включающий устройства "умного дома",
    промышленные системы управления,
    портативные технологии
    и мониторы критически важной инфраструктуры,
    так же требуют бережного отношения
    к имеющейся информации.

  - Оборона и аэрокосмическая промышленность: <br>
    Спрос на поддающуюся верификации безопасность
    и целостность цепочки поставок
    делает открытые аппаратные
    и программные решения привлекательными
    и для критически важных систем
    военного и аэрокосмического типа.

  - Финансовые технологии (FinTech): <br>
    Безопасные интерфейсы RISC-V могут стать основой
    решений банковской и финансовой сферы,
    обеспечивая безопасность транзакций,
    криптографических ключей
    и обеспечивая безопасные механизмы
    аутентификации для мобильного банкинга и платежных систем.

 ## 1.4. Сравнение с существующими архитектурами

  ### 1.4.1. ARM TrustZone: Централизованная модель безопасного мира

   #### 1.4.1.1. Обзор ARM TrustZone

   Технология ARM TrustZone обеспечивает
   аппаратное разделение системы на кристалле
   на две отдельные среды выполнения:
   нормальный мир (Normal World / NWd)
   и безопасный мир (Secure World / SWd).
   Это разделение достигается на уровне процессора
   с помощью специального режима монитора (Monitor Mode)
   и аппаратного обеспечения системного уровня,
   контролирующего доступ к памяти
   и периферийным устройствам
   на основе текущего мира исполняющего ядра.
   В нормальном мире обычно используется
   богатая функционалом операционная система (Rich OS),
   такая как Linux или Android,
   в то время как в безопасном мире используется
   меньшая по размеру и более надежная операционная система
   (Trusted OS или Secure OS).
   Эта доверенная ОС, в свою очередь,
   управляет и запускает доверенные приложениями
   (Trusted Applications / TAs).
   Переходы между нормальным и безопасным миром
   осуществляются с помощью инструкции *SMC*.
   Оба мира могут работать на одном и том же процессорном ядре,
   а аппаратное обеспечение гарантирует,
   что программное обеспечение обычного мира
   не сможет напрямую получить доступ к ресурсам,
   выделенным для безопасного мира.

   #### 1.4.1.2. Преимущества ARM TrustZone

  - Развитая экосистема и широкое внедрение: <br>
    TrustZone доступна уже много лет
    и широко используется на самых разных устройствах,
    особенно в мобильных и встраиваемых системах.
    Результатом стала развитая экосистема
    с обширным набором инструментов,
    документацией, опытом разработчиков
    и легкодоступными реализациями защищенных ОС.

  - Эффективное переключение контекста: <br>
    Аппаратный механизм переключения
    между обычным и защищенным миром,
    с помощью инструкции SMC
    и специальной аппаратной поддержки,
    в целом эффективен, так как аргументы для TA
    передаются через регистры.
    Это позволяет осуществлять переходы
    с относительно низкой задержкой
    при обращении к TA.

  - Хорошо поддерживаемые отраслевые стандарты: <br>
    Реализации TrustZone соответствуют отраслевым стандартам,
    в частности, тем, которые определены
    стандартами GlobalPlatform.
    Эти стандарты определяют API
    и поведение системы для ДСИ,
    обеспечивая совместимость между различными
    доверенными приложениями
    и реализациями Secure OS,
    облегчая разработку общего программного стека ДСИ.

   #### 1.4.1.3. Недостатки ARM TrustZone

  - Централизованная архитектура: <br>
    Защищенный мир в TrustZone работает
    как единый монолитный объект,
    управляемый одним экземпляром Secure OS.
    Все защищенные операции со всех
    ядер проходят через этот централизованный защищенный мир,
    что может привести к снижению производительности,
    если многим приложениям или ядрам обычного мира
    одновременно требуются защищенные службы.

  - Высокая стоимость полного цикла взаимодействия: <br>
    Полный запрос от обычного Normal world приложения
    в пользовательском пространстве (EL0)
    к доверенному приложению
    в пользовательском пространстве (EL0) защищенного мира
    и ответ на него трубуют восемь
    переключений контекста с использованием
    различных уровней привилегий
    и режима мониторинга.
    Это значительно увеличивает общую задержку
    и накладные расходы на запросы в secure world,
    даже несмотря на то что сами переключения контекста
    имеют аппаратную оптимизацию.

  - Блокирование на защищенных операциях: <br>
    Когда приложение нормального мира
    на определенном ядре выполняет
    вызов SMC в Secure World, это ядро блокируется,
    переключая исполнение в Secure World.
    Это может негативно сказаться
    на быстродействии и производительности
    приложения нормального мира, работающего на этом ядре.

  - Ограниченная масштабируемость в многоядерных системах: <br>
    в то время как отдельные ядра
    могут переключаться в защищенный мир,
    общая модель предполагает использование
    одного экземпляра Secure OS,
    управляющей всем защищенным миром на всех ядрах.
    Это может привести к конкуренции
    за общие защищенные ресурсы
    и сложностям в управлении
    параллельными защищенными операциями,
    что потенциально ограничивает масштабируемость
    в высокопараллельных многоядерных сценариях.

  - Уязвимость к атакам по сторонним каналам:
    Несмотря на аппаратную изоляцию,
    совместное использование
    базовых физических аппаратных ресурсов
    (таких как кэш-память,
    контроллеры памяти и шины)
    между нормальным и защищенным миром
    по-прежнему может привести к уязвимостям
    для side-channel атак,
    что может привести к утечке информации.

  ### 1.4.2. Intel Software Guard Extensions (SGX): Изоляция на базе анклавов.

   #### 1.4.2.1. Обзор Intel SGX

   Intel Software Guard Extensions (SGX)
   позволяют создавать анклавы -
   частные области памяти,
   изолированные в адресном пространстве приложения.
   Эти анклавы защищены центральным процессором,
   обеспечивая аппаратно-принудительную конфиденциальность
   и целостность кода и данных,
   находящихся внутри них,
   даже от привилегированного программного обеспечения,
   такого как операционная система или гипервизор.
   Память, связанная с анклавом, шифруется процессором,
   и при исполнении расшифровывается налету.
   Приложения могут выборочно размещать
   чувствительные участки своего кода
   и данных в этих анклавах,
   обеспечивая гранулярную изоляцию для каждого процесса.

   #### 1.4.2.2. Преимущества Intel SGX

   SGX предлагает значительную гибкость,
   поскольку приложения могут определять
   и управлять своими анклавами независимо,
   позволяя множеству анклавов из разных приложений
   сосуществовать в системе.
   Технология включает мощные возможности
   шифрования памяти для данных внутри анклавов
   и предоставляет надежные механизмы удаленной аттестации.
   Аттестация позволяет удаленной стороне
   проверить подлинность и целостность программного обеспечения,
   работающего внутри анклава.
   Ключевой архитектурной особенностью является то,
   что SGX не требует отдельной,
   выделенной доверенной операционной системы.
   Анклавы функционируют как защищенные среды
   пользовательского режима,
   управляемые, но недоступные для доступа хостовой ОС.

   #### 1.4.2.3. Недостатки Intel SGX

   Основным ограничением SGX является,
   как правило, небольшой размер кэша страниц анклава (EPC) -
   защищенной области ОЗУ,
   где хранятся страницы анклава,
   что может влиять на производительность
   и возможность портирования больших приложений.
   Модель программирования для SGX сложна,
   часто требует значительной реструктуризации кода
   и потенциально создает проблемы совместимости
   с существующими библиотеками или приложениями.
   Анклавы SGX ограничены выполнением
   только в пользовательском режиме (кольцо защиты ring-3),
   что означает, что полноценная,
   привилегированная доверенная операционная система
   не может быть размещена внутри анклава SGX.
   Кроме того, SGX стала целью
   многочисленных side-channel атак и атак,
   использующих спекулятивное исполнение,
   что требует постоянных исследований
   и мер по их митигайциям.
   Накладные расходы на производительность,
   связанные с операциями входа в анклав (ECALL)
   и выхода из него (OCALL),
   а также шифрованием памяти,
   также могут быть существенным фактором
   для определенных рабочих нагрузок.

  ### 1.4.3. AMD Secure Encrypted Virtualization (SEV): Шифрование памяти на уровне ВМ

   #### 1.4.3.1. Обзор AMD SEV

   Технология зашифрованной виртуализации AMD
   Secure Encrypted Virtualization
   разработана для усиления безопасности
   в виртуализированных средах.
   Это достигается путем предоставления
   полного шифрования памяти
   для гостевых виртуальных машин (ВМ),
   тем самым защищая их от потенциальных угроз,
   исходящих от скомпрометированного
   вредоносного гипервизора.
   SEV в первую очередь ориентирована
   на сценарии облачных вычислений,
   где первостепенное значение имеет
   надежная изоляция между несколькими арендаторами,
   сосуществующими на общем физическом оборудовании.
   Память каждой гостевой ВМ
   может быть зашифрована с использованием уникального ключа,
   управляемого безопасным процессором AMD
   (AMD Secure Processor),
   обеспечивая конфиденциальность данных
   даже в случае несанкционированного доступа
   гипервизора к страницам памяти гостевой системы.

   #### 1.4.3.2. Преимущества AMD SEV

   Одним из значительных преимуществ SEV
   является практически бесшовный способ
   обеспечения защиты виртуальных машин.
   Гостевые операционные системы
   и их приложения обычно требуют
   незначительных изменений
   или не требуют их вовсе
   для использования зашифрованной памяти.
   Технология использует надежное,
   аппаратно-ускоренное AES-шифрование для памяти ВМ.
   Этот процесс шифрования и дешифрования
   выполняется в режиме реального времени
   выделенным аппаратным обеспечением
   при обращении к памяти,
   с целью обеспечения конфиденциальности данных
   гостевой ВМ во время их нахождения
   в DRAM или при передаче.

   #### 1.4.3.3. Недостатки

   Несмотря на свою эффективность в защите памяти ВМ,
   архитектура SEV, ориентированная на шифрование всей ВМ,
   делает ее по своей сути неподходящей
   для роли доверенной среды исполнения
   в контексте изоляции отдельных приложений.
   Ее основная ориентация на безопасность
   виртуализации означает,
   что она работает с гораздо более
   грубой гранулярностью - вся ВМ,
   по сравнению с анклавными моделями,
   Intel SGX, или отдельными архитектурами
   безопасного мира ARM TrustZone.
   Следовательно, SEV - это, по сути,
   механизм защиты ВМ от недоверенного гипервизора,
   а не предоставление выделенной изолированной среды
   для запуска конкретных доверенных приложений
   с детальным контролем в рамках одной операционной системы,
   что является основным вариантом использования TEE.
   Это различие ограничивает ее применимость для сценариев,
   требующих изоляции на уровне приложений
   и специфической модели программирования
   для выполнения доверенного кода,
   отличной от основной ОС.

  ### 1.4.4. RISC-V Physical Memory Protection (PMP): Изоляция по уровням исполнения

   #### 1.4.4.1. Обзор RISC-V PMP

   Physical Memory Protection - это стандартный
   аппаратный механизм,
   определённый в спецификации
   привилегированной ISA RISC-V.
   Он предоставляет средства
   для контроля прав доступа к областям физической памяти.
   PMP позволяет привилегированному
   программному обеспечению,
   например, выполняющемуся в Машинном режиме (M-mode),
   определять множество областей памяти,
   каждая из которых имеет специфические права доступа
   (Чтение, Запись, Исполнение).
   Эти права могут быть установлены независимо
   для различных уровней привилегий
   (M-mode, S-mode, U-mode).
   Конфигурация PMP управляется через набор
   CSR регистров:
   *pmpcfgN* - для конфигурации областей
   и *pmpaddrN* для адресов областей.

   #### 1.4.4.2. Преимущества RISC-V PMP

   - Стандартное расширение: <br>
     Являясь частью базовой привилегированной ISA,
     PMP доступна на всех процессорах RISC-V,
     предлагая базовые возможности защиты памяти
     без необходимости использования
     пользовательских расширений.

   - Аппаратная безопасность: <br>
     Проверки прав доступа выполняются аппаратно
     при каждом обращении к памяти,
     что обеспечивает низкие накладные расходы
     на производительность
     и надёжное применение определённых
     политик защиты памяти.

   - Изоляция на уровне привилегий: <br>
     PMP эффективна для установления
     фундаментальных границ изоляции
     между различными режимами привилегий.
     Например, она может предотвратить доступ
     приложений Пользовательского режима (U-mode)
     к памяти ОС режима S-mode
     или областям SEE M-режима.

   - Гибкое определение регионов: <br>
     PMP поддерживает различные способы
     конфигурирования регионов,
     включая TOR, NA4, NAPOT.

   #### 1.4.4.3. Недостатки RISC-V PMP

   - Изоляция, ориентированная на уровни привилегий: <br>
     PMP обеспечивает изоляцию
     на основе уровней привилегий (M, S, U).
     Она по своей сути не предоставляет механизмов
     для изоляции программных компонентов,
     работающих в пределах
     одного и того же уровня привилегий,
     и не устанавливает отдельные домены безопасности,
     независимые от уровня привилегий,
     что является фундаментальным требованием для TEE.
     Таким образом, сам по себе механизм PMP
     не подходит для полноценных реализаций TEE.

   - Ограниченное количество регионов: <br>
     Стандарт RISC-V определяет
     небольшое количество записей PMP
     (8, 16, или до 64 для RV64).
     Это ограниченное количество
     может быть недостаточным для сложных систем,
     требующих гранулярного разделения
     множества областей памяти.

   - Преимущественно статическая конфигурация: <br>
     Записи PMP обычно настраиваются
     программным обеспечением M-режима
     на ранней стадии загрузки.
     Хотя PMP и перенастраиваема,
     она не предназначена для
     высокодинамичного создания
     и управления изолированными областями памяти
     во время выполнения
     менее привилегированными субъектами,
     как это часто требуется TEE для функциональности,
     подобной анклавам,
     или для управления несколькими
     доверенными приложениями.

  ### 1.4.5. RISC-V WorldGuard расширение: Децентрализованная изоляция.

   #### 1.4.5.1. Обзор RISC-V WorldGuard

   RISC-V WorldGuard - это аппаратное расширение,
   предназначенное для обеспечения
   надежного разделения памяти и исполнителей.
   Оно предлагает более гранулярный подход
   к изоляции по сравнению
   с традиционными моделями двух миров,
   такими как в ARM TrustZone.
   WorldGuard обеспечивает возможность
   создания множества независимых
   изолированных доменов выполнения,
   называемых мирами (worlds).
   Этим мирам могут быть назначены
   различные привилегии и ресурсы,
   а на многоядерных системах разные миры
   потенциально могут работать параллельно
   на отдельных ядрах ЦП.
   Расширение предоставляет механизмы
   для контроля доступа к областям памяти
   и периферийным устройствам,
   обеспечивая изоляцию между мирами
   на аппаратном уровне.

   #### 1.4.5.2. Преимущества RISC-V WorldGuard

  - Децентрализованный дизайн и масштабируемость: <br>
    Архитектура поддерживает множество независимых миров,
    повышая масштабируемость и гибкость,
    особенно для многоядерных процессоров
    и многопользовательских сред.
    Каждое ядро может работать в контексте отдельного мира,
    обеспечивая истинный параллелизм
    между изолированными средами.

  - Открытость и прозрачность: <br>
    Являясь частью открытой архитектуры
    набора команд (ISA) RISC-V,
    WorldGuard выигрывает от разработки
    и верификации сообществом,
    что ведет к прозрачным реализациям
    решений безопасности.

  - Расширенные возможности и совместимость: <br>
    WorldGuard предлагает
    расширенный набор функций безопасности
    по сравнению с более простыми моделями.
    Например, конфигурация с двумя мирами
    может точно эмулировать модель TrustZone,
    облегчая использование устоявшихся API,
    таких как GlobalPlatform TEE API.

  - Неблокирующие безопасные сервисы: <br>
    Возможность выделять определенные ядра
    для безопасных миров
    (например, для Secure OS)
    позволяет выполнять неблокирующие вызовы
    из других миров (например, из Rich OS, такой как Linux),
    улучшая отзывчивость системы
    по сравнению с архитектурами,
    требующими переключения мира на том же ядре.

  - Множество одновременно работающих ДСИ: <br>
    Дизайн по своей сути не ограничивает
    сосуществование и одновременную работу
    нескольких экземпляров TEE,
    каждый из которых потенциально обслуживает
    различные требования безопасности
    или различные Rich OS.

   #### 1.4.5.3. Недостатки RISC-V WorldGuard

  - Ранний этап стандартизации и зрелости экосистемы: <br>
    WorldGuard является относительно новым расширением.
    Стандартизация продолжается,
    а широкое распространение аппаратных реализаций
    и всесторонней программной поддержки
    все еще находится в процессе.

  - Потребность в стеке безопасного ПО:
    Одних только аппаратных возможностей
    WorldGuard недостаточно.
    Полное решение TEE требует наличия
    надежной и специально разработанной
    Secure OS, сред выполнения,
    инструментов разработки доверенных приложений,
    механизмов безопасной загрузки и драйверов.
    Эта фундаментальная экосистема
    в настоящее время существует
    в основном на экспериментальных стадиях.
