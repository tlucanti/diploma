
# Глава 2. Основные принципы доверенной среды исполнения и модель угроз

 ## 2.1. Обзор доверенной среды исполнения

  ### 2.1.1. Определение и основные принципы

   #### 2.1.1.1. Доверенная среда исполнения

   Доверенная среда исполнения (ДСИ), или же
   Trusted Execution Environment (TEE) - это безопасная,
   изолированная область внутри центрального процессора.
   Она предназначена для выполнения кода
   и обработки данных с повышенным уровнем конфиденциальности
   и целостности по сравнению со стандартной операционной средой,
   называемой универсальной средой исполнения (УСИ), или же
   Rich Execution Environment (REE).

   В рамках ДСИ работает специализированная
   безопасная операционная система, называемая
   доверенной операционной системой (Secure OS),
   которая работает параллельно обыкновенной операционной
   системе в УСИ, называемой
   универсальной операционной системой (Rich OS).

   ДСИ гарантирует защиту таких активов,
   как конфиденциальные данные и критически важный код,
   которые хранятся и обрабатываются в её пределах
   и остаются недоступными,
   даже в случае компроментации REE операционной системы
   или приложений УСИ.

   Защита реализуется посредством сочетания
   аппаратных и программных механизмов,
   которые обеспечивают строгую изоляцию между ДСИ и УСИ.
   Функционирование и гарантии безопасности ДСИ базируются
   на ряде ключевых принципов,
   детально рассмотренных далее.

   #### 2.1.1.2 Изоляция

   Изоляция в контексте доверенной среды исполнения
   представляет собой фундаментальный принцип разделения
   вычислительной среды на две физически разграниченные области:
   нормальный мир (Normal World), и защищённый мир (Secure World).
   Такое разделение гарантирует,
   что операции и данные в защищённом мире защищены
   от вмешательства или несанкционированного доступа
   со стороны программного обеспечения,
   работающего в обычном мире,
   включая основную операционную систему и её приложения.
   Для поддержания этого разделения обычно используются
   аппаратные механизмы изоляции,
   которые предотвращают прямой доступ кода
   из одного мира к ресурсам или памяти,
   выделенным другому миру,
   за исключением случаев,
   когда это явно разрешено через строго контролируемые интерфейсы.

   #### 2.1.1.3 Целостность

   Целостность в TEE гарантирует,
   что код и данные, находящиеся
   и обрабатываемые в защищённом мире,
   остаются неизменными
   и сохраняют своё первоначальное состояние.
   Это означает, что ни внешние субъекты из обычного мира,
   ни неавторизованные процессы внутри защищённого мира
   не могут модифицировать критически важный код,
   такой как операционная система TEE
   или доверенные приложения,
   а также управляемые ими чувствительные данные.
   Целостность обычно обеспечивается такими механизмами,
   как безопасная загрузка (secure boot),
   подписанный и зашифрованый код,
   защита памяти во время исполнения
   и использование криптографических контрольных сумм.
   Это гарантирует выполнение только проверенных
   и аутентичных программных компонентов
   и защиту данных от злонамеренных изменений.

   #### 2.1.1.4 Конфиденциальность

   Конфиденциальность - это принцип TEE,
   обеспечивающий защиту данных и кода в защищённом мире
   от несанкционированного раскрытия.
   Это означает, что никакой программный компонент,
   работающий за пределами TEE,
   включая потенциально скомпрометированную
   операционную систему обычного мира
   или привилегированные приложения,
   не может считывать или получать доступ
   к приватным областям памяти TEE.
   Конфиденциальность распространяется
   как на данные в процессе обработки
   (например, обрабатываемые криптографические ключи),
   так и на хранимые данные.

   #### 2.1.1.5 Защищённое хранилище

   Защищённое хранилище (Secure Storage) -
   это функциональная возможность TEE,
   предоставляющая механизм для
   постоянного хранения чувствительных данных,
   таких как криптографические ключи,
   учетные данные пользователей
   или другая конфиденциальная информация,
   способом, который защищает их конфиденциальность
   и целостность даже при
   выключенном питании системы.
   Данные, сохраняемые с использованием этого механизма,
   шифруются и защищаются с использованием ключей,
   управляемых внутри TEE.
   Доступ к этим сохраненным данным
   строго контролируется TEE, гарантируя,
   что только авторизованные доверенные приложения
   могут извлекать или изменять
   принадлежащую им чувствительную информацию.

   #### 2.1.1.6 Аттестация

   Аттестация позволяет TEE
   доказать свою подлинность
   и целостность исполняемой в ней
   программной среды удалённой стороне.
   Этот процесс обычно включает генерацию
   TEE подписанного отчёта,
   содержащего измерения её аппаратной конфигурации,
   микропрограмм, ОС и загруженных доверенных приложений.
   Удалённая сторона может проверить этот отчёт
   с использованием доверенного ключа,
   тем самым получая уверенность в том,
   что она взаимодействует с подлинной TEE
   и что конфигурация программного обеспечения
   соответствует ожиданиям и не была скомпрометирована.

   #### 2.1.1.7 Доверенное исполнение

   Доверенное исполнение (Trusted Execution)
   гарантирует, что только авторизованный
   и проверенный код допускается к запуску в пределах TEE.
   Это включает механизмы аутентификации кода
   (например, с помощью цифровых подписей)
   перед его загрузкой и выполнением в защищённом мире.
   Ограничивая исполнение только известными и
   проверенными программными компонентами,
   TEE поддерживает контролируемую и безопасную среду,
   предотвращая выполнение вредоносного или
   недоверенного кода.

   #### 2.1.1.8 Минимальная доверенная вычислительная база

   Принцип минимальной доверенной вычислительной базы
   (Minimal Trusted Computing Base, TCB)
   заключается в том,
   что совокупность всех аппаратных,
   микропрограммных и программных компонентов,
   критически важных для обеспечения политики безопасности системы,
   должна быть как можно меньше.
   Минимизация TCB сокращает поверхность атаки,
   упрощает анализ и верификацию безопасности,
   а также снижает вероятность наличия уязвимостей,
   способных скомпрометировать всю TEE.
   В TCB обычно входят защищённые аппаратные элементы,
   доверенные загрузчики, ядро Secure OS и
   набор основных доверенных сервисов.
   Основой доверия к самой TCB служит
   аппаратный корень доверия (RoT).

  ### 2.1.2. Требования к безопасности и цели проектирования

   #### 2.1.2.1. Ключевые компоненты

   В основе архитектуры доверенной среды исполнения
   лежит набор фундаментальных компонентов.
   Каждый из них вносит свой вклад
   в обеспечение общей безопасности системы.
   Эти компоненты, подробно рассмотренные далее,
   совместно создают и поддерживают доверенную среду,
   определяя ее структуру, операционные границы
   и протоколы взаимодействия.

   #### 2.1.2.2. Изолированный исполнительный блок

   Одним из фундаментальных требований
   является наличие физически изолированного
   исполнительного блока,
   обеспечивающего аппаратное разделение
   для выполнения защищенного кода.
   В рамках данного проекта эта роль отводится
   выделенному ядру центрального процессора,
   эксклюзивно назначенному для Secure OS.
   Данный блок гарантирует,
   что операции внутри TEE
   защищены от прямого наблюдения или вмешательства
   со стороны недоверенного программного обеспечения,
   работающего на других ядрах
   или в менее привилегированных режимах выполнения.

   #### 2.1.2.3. Нормальный мир

   Нормальный мир (Normal World)
   представляет собой недоверенный домен исполнения,
   являющийся универсальной средой исполнения
   (Rich Execution Environment),
   в которой функционирует операционная система
   общего назначения, такая как Linux, и ее приложения.
   Все программное обеспечение в нормальном мире
   рассматривается TEE как потенциально враждебное
   и аппаратно лишено возможности
   прямого доступа к ресурсам защищенного мира.

   #### 2.1.2.4. Защищенный мир

   В свою очередь, защищенный мир (Secure World) - это
   доверенный домен, являющийся доверенной средой исполнения
   (Trusted Execution Environment),
   в которой функционирует Secure OS и доверенные приложения.
   Он спроектирован таким образом,
   чтобы противостоять угрозам,
   исходящим из нормального мира,
   гарантируя конфиденциальность и целостность
   управляемых им активов и выполняемых вычислений.

   #### 2.1.2.5. Доверенные приложения

   Доверенные приложения (TA) - это
   специализированные программные модули,
   исполняемые в защищенном мире
   для выполнения критически важных
   с точки зрения безопасности операций
   по запросу клиентов из нормального мира.
   TA предоставляют такие функции,
   как безопасная обработка данных,
   криптографические операции
   или управление чувствительными данными,
   доступ к которым осуществляется
   через четко определенные и контролируемые интерфейсы.

   #### 2.1.2.6. Защищенные API

   Защищенные API (Secure APIs) определяют контролируемые интерфейсы,
   через которые программное обеспечение нормального мира
   может запрашивать службы у защищенного мира,
   в частности, у доверенных приложений.
   Эти API, такие как подмножество
   GlobalPlatform TEE Client API и
   GlobalPlatform TEE Core API,
   функционируют как строго контролируемые шлюзы.
   Они отвечают за преобразование данных и гарантируют,
   что все взаимодействия четко определены,
   проверены и авторизованы в соответствии
   с политиками безопасности TEE перед
   выполнением службы в pащищенном мире.